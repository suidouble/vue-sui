(function(d,c){typeof exports=="object"&&typeof module<"u"?c(exports,require("suidouble"),require("vue")):typeof define=="function"&&define.amd?define(["exports","suidouble","vue"],c):(d=typeof globalThis<"u"?globalThis:d||self,c(d.VueSui={},d.Suidouble,d.Vue))})(this,function(d,c,i){"use strict";var p=document.createElement("style");p.textContent=`.signinwithsui_button[data-v-5933915b]{background:linear-gradient(#3b9ff7,#1a4e85);border-radius:2px;display:inline-block;color:#fff;font-family:Arial;font-size:15px;padding:8px 16px;text-decoration:none;text-shadow:0px 1px 0px #263666;-webkit-user-select:none;user-select:none;margin:0;background-size:1px 200px;cursor:pointer;transition:background .2s ease-out}.signinwithsui_button .signinwithsui_button_inner[data-v-5933915b]{display:inline-block}.signinwithsui_button .signinwithsui_button_inner[data-v-5933915b]:nth-child(2){padding-left:16px}.signinwithsui_button[data-v-5933915b]:hover{background-position:100px}.signinwithsui_dialog[data-v-5933915b]{color:#fff;text-shadow:none;top:0;right:0;bottom:0;left:0;z-index:60000;border-radius:0!important;max-width:100vw;max-height:100vh;position:fixed;pointer-events:none!important;display:block}.signinwithsui_dialog_backdrop[data-v-5933915b]{top:0;right:0;bottom:0;left:0;z-index:-1;pointer-events:all;outline:0;background:#0003;position:fixed}.signinwithsui_dialog_inner[data-v-5933915b]{top:0;right:0;left:0;justify-content:center;display:flex;flex-wrap:wrap;padding-top:0!important;padding-bottom:0!important;padding:24px;outline:0;transform:translateY(-100%);transition:transform .3s ease-in-out}.signinwithsui_dialog_inner.signinwithsui_dialog_inner_active[data-v-5933915b]{transform:translateY(0)}.signinwithsui_dialog_inner_card[data-v-5933915b]{background-color:#3898ec99;-webkit-backdrop-filter:blur(7px);backdrop-filter:blur(7px);-webkit-tap-highlight-color:transparent;position:relative;vertical-align:top;border-color:#ffffff47;box-shadow:0 1px 5px #fff3,0 2px 2px #ffffff24,0 3px 1px -2px #ffffff1f;pointer-events:all;overflow:auto;-webkit-overflow-scrolling:touch;will-change:scroll-position;border-radius:0 0 4px 4px;width:50%;max-width:560px;max-height:calc(100vh - 48px)}.signinwithsui_dialog_item[data-v-5933915b]{cursor:pointer;outline:0;text-decoration:none;flex-wrap:nowrap;position:relative;display:flex;color:#fff;border-color:#ffffff47;min-height:48px;padding:8px 16px;color:inherit;transition:color .3s,background-color .3s;pointer-events:all;background-color:transparent;-webkit-user-select:none;user-select:none}.signinwithsui_dialog_item_disabled[data-v-5933915b]{opacity:.4}.signinwithsui_dialog_item[data-v-5933915b]:hover{background-color:#0000004d}.signinwithsui_dialog_item_column[data-v-5933915b]{align-items:flex-start;padding-right:16px;width:auto;min-width:0;max-width:100%;display:flex;flex-wrap:wrap;justify-content:center;flex-direction:column;color:inherit}.signinwithsui_dialog_item_icon[data-v-5933915b]{width:42px;height:42px;overflow:hidden}.signinwithsui_dialog_item_name[data-v-5933915b]{height:42px;font-size:16px;padding-left:16px}.signinwithsui_dialog_item_icon img[data-v-5933915b]{width:42px;height:42px}.signinwithsui_button[data-v-9be482c4]{background:linear-gradient(#3b9ff7,#1a4e85);border-radius:2px;display:inline-block;color:#fff;font-family:Arial;font-size:15px;padding:8px 16px;text-decoration:none;text-shadow:0px 1px 0px #263666;-webkit-user-select:none;user-select:none;margin:0;background-size:1px 200px;cursor:pointer;transition:background .2s ease-out}.signinwithsui_button .signinwithsui_button_inner[data-v-9be482c4]{display:inline-block}.signinwithsui_button .signinwithsui_button_inner[data-v-9be482c4]:nth-child(2){padding-left:16px}.signinwithsui_button[data-v-9be482c4]:hover{background-position:100px}.signinwithsui_dialog[data-v-9be482c4]{color:#fff;text-shadow:none;top:0;right:0;bottom:0;left:0;z-index:60000;border-radius:0!important;max-width:100vw;max-height:100vh;position:fixed;pointer-events:none!important;display:block}.signinwithsui_dialog_backdrop[data-v-9be482c4]{top:0;right:0;bottom:0;left:0;z-index:-1;pointer-events:all;outline:0;background:#0003;position:fixed}.signinwithsui_dialog_inner[data-v-9be482c4]{top:0;right:0;left:0;justify-content:center;display:flex;flex-wrap:wrap;padding-top:0!important;padding-bottom:0!important;padding:24px;outline:0;transform:translateY(-100%);transition:transform .3s ease-in-out}.signinwithsui_dialog_inner.signinwithsui_dialog_inner_active[data-v-9be482c4]{transform:translateY(0)}.signinwithsui_dialog_inner_card[data-v-9be482c4]{background-color:#3898ec99;-webkit-backdrop-filter:blur(7px);backdrop-filter:blur(7px);-webkit-tap-highlight-color:transparent;position:relative;vertical-align:top;border-color:#ffffff47;box-shadow:0 1px 5px #fff3,0 2px 2px #ffffff24,0 3px 1px -2px #ffffff1f;pointer-events:all;overflow:auto;-webkit-overflow-scrolling:touch;will-change:scroll-position;border-radius:0 0 4px 4px;width:50%;max-width:560px;max-height:calc(100vh - 48px)}.signinwithsui_dialog_item[data-v-9be482c4]{cursor:pointer;outline:0;text-decoration:none;flex-wrap:nowrap;position:relative;display:flex;color:#fff;border-color:#ffffff47;min-height:48px;padding:8px 16px;color:inherit;transition:color .3s,background-color .3s;pointer-events:all;background-color:transparent;-webkit-user-select:none;user-select:none}.signinwithsui_dialog_item_disabled[data-v-9be482c4]{opacity:.4}.signinwithsui_dialog_item[data-v-9be482c4]:hover{background-color:#0000004d}.signinwithsui_dialog_item_column[data-v-9be482c4]{align-items:flex-start;padding-right:16px;width:auto;min-width:0;max-width:100%;display:flex;flex-wrap:wrap;justify-content:center;flex-direction:column;color:inherit}.signinwithsui_dialog_item_icon[data-v-9be482c4]{width:42px;height:42px;overflow:hidden}.signinwithsui_dialog_item_name[data-v-9be482c4]{height:42px;font-size:16px;padding-left:16px}.signinwithsui_dialog_item_icon img[data-v-9be482c4]{width:42px;height:42px}
/*$vite$:1*/`,document.head.appendChild(p);const h=(e,t)=>{const s=e.__vccOpts||e;for(const[a,o]of t)s[a]=o;return s},g={name:"SuiSync",props:{defaultChain:{default:"sui:devnet",type:String},rpcSettings:{type:Object}},data(){return{connectedAddress:null,connectedChain:null,adapters:[],suiInBrowser:null,suiMaster:null,lastSuiMasterInstanceN:null}},emits:["connect","connected","loaded","disconnected","error","suiMaster","adapters"],components:{},watch:{},methods:{async reinitSuiMaster(){this.suiMaster=await this.suiInBrowser.getSuiMaster(),(!this.lastSuiMasterInstanceN||this.lastSuiMasterInstanceN!=this.suiMaster.instanceN)&&this.$emit("suiMaster",this.suiMaster)},async setRPC(e={}){await this.suiInBrowser.setRPC(e),await this.reinitSuiMaster()}},mounted:function(){this.suiInBrowser=c.SuiInBrowser.getSingleton({debug:!0,defaultChain:this.defaultChain}),this.rpcSettings&&this.suiInBrowser.setRPC(this.rpcSettings),this.adapters=Object.values(this.suiInBrowser.adapters),this.suiInBrowser.addEventListener("adapter",e=>{this.adapters.push(e.detail),this.$emit("adapters",this.adapters)}),this.suiInBrowser.addEventListener("connected",()=>{this.connectedAddress=this.suiInBrowser.connectedAddress,this.connectedChain=this.suiInBrowser.connectedChain,this.reinitSuiMaster(),this.$emit("connected",this.suiInBrowser)}),this.suiInBrowser.addEventListener("disconnected",()=>{this.connectedAddress=null,this.connectedChain=null,this.$emit("disconnected")}),this.$nextTick(()=>{this.$emit("loaded",this.suiInBrowser),this.$emit("adapters",this.adapters)}),this.suiInBrowser.isConnected&&(this.connectedAddress=this.suiInBrowser.connectedAddress,this.connectedChain=this.suiInBrowser.connectedChain,this.reinitSuiMaster(),this.$emit("connected",this.suiInBrowser)),this.reinitSuiMaster()},computed:{}};function m(e,t,s,a,o,n){return i.openBlock(),i.createElementBlock("div")}const _=h(g,[["render",m]]),w={name:"SignInWithSuiDialog",emits:["click","hidden"],props:{adapters:{type:Array,default(){return[]}},showing:{type:Boolean,default:!1}},data(){return{isActive:!1,isVisible:!1}},watch:{showing:function(){this.showing?this.show():this.hide()}},computed:{},components:{},methods:{onAdapterClick(e){this.$emit("click",e)},show(){this.isActive=!0,setTimeout(()=>{this.isVisible=!0},10)},hide(){this.isVisible=!1,setTimeout(()=>{this.isActive=!1,this.$emit("hidden")},300)},onBackdrop(){this.hide()}},beforeMount:function(){},mounted:async function(){}},b={key:0,class:"signinwithsui_dialog"},x={class:"signinwithsui_dialog_inner_card"},S={class:"signinwithsui_dialog_list"},k=["onClick"],v={class:"signinwithsui_dialog_item_column signinwithsui_dialog_item_icon"},y=["src"],C={class:"signinwithsui_dialog_item_column signinwithsui_dialog_item_name"};function M(e,t,s,a,o,n){return o.isActive?(i.openBlock(),i.createElementBlock("div",b,[i.createElementVNode("div",{class:"signinwithsui_dialog_backdrop",onClick:t[0]||(t[0]=(...r)=>n.onBackdrop&&n.onBackdrop(...r))}),i.createElementVNode("div",{class:i.normalizeClass(["signinwithsui_dialog_inner",{signinwithsui_dialog_inner_active:o.isVisible}])},[i.createElementVNode("div",x,[i.createElementVNode("div",S,[(i.openBlock(!0),i.createElementBlock(i.Fragment,null,i.renderList(s.adapters,(r,l)=>(i.openBlock(),i.createElementBlock(i.Fragment,{key:l},[r.isDefault||r.okForSui?(i.openBlock(),i.createElementBlock("div",{key:0,class:i.normalizeClass(["signinwithsui_dialog_item",{signinwithsui_dialog_item_disabled:r.isDefault}]),onClick:u=>n.onAdapterClick(r)},[i.createElementVNode("div",v,[i.createElementVNode("img",{loading:"lazy",fetchpriority:"auto","aria-hidden":"true",draggable:"false",src:r.icon},null,8,y)]),i.createElementVNode("div",C,i.toDisplayString(r.name),1)],10,k)):i.createCommentVNode("",!0)],64))),128))])])],2)])):i.createCommentVNode("",!0)}const A={name:"SignInWithSui",emits:["suiMaster","provider","client","adapter","disconnected","connected","wrongchain","displayAddress"],props:{defaultChain:{default:"sui:devnet",type:String},rpcSettings:{type:Object},auto:{default:!0,type:Boolean},visible:{default:!0,type:Boolean},persist:{default:!1,type:Boolean}},data(){return{isLoading:!1,libsRequested:!0,adapters:[],connectedAddress:null,displayAddress:null,resolvedNameServiceName:null,connectedChain:null,forceChainCalculated:null,suiMaster:null,activeAdapter:null,showingDialog:!1}},watch:{defaultChain:async function(){this.connectedAddress=null,this.connectedChain=null,this.suiMaster=null,this.libsRequested=!1,await new Promise(e=>setTimeout(e,50)),this.libsRequested=!0}},computed:{},components:{SuidoubleSync:_,SignInWithSuiDialog:h(w,[["render",M],["__scopeId","data-v-5933915b"]])},methods:{checkDisplayAddress(){let e=this.displayAddress;this.connectedAddress?this.connectedAddress&&(this.resolvedNameServiceName?e=this.resolvedNameServiceName:e=(""+this.connectedAddress).substr(0,6)+"..."+(""+this.connectedAddress).substr(-4)):e=null,this.displayAddress!=e&&(this.displayAddress=e,this.$emit("displayAddress",this.displayAddress))},async getNameServiceName(){if(this.suiMaster&&this.suiMaster.address){const e="resolvedNameServiceName_"+this.suiMaster.connectedChain+":"+this.suiMaster.address,t=10*60*1e3,s=this.getCache(e);if(s!==void 0)this.resolvedNameServiceName=s;else{const a=await this.suiMaster.resolveNameServiceName();this.resolvedNameServiceName=a,this.setCache(e,a,t)}this.checkDisplayAddress()}else this.resolvedNameServiceName=null,this.checkDisplayAddress()},onSuiMaster(e){this.suiMaster=e,(!this.defaultChain||this.defaultChain==this.suiMaster.connectedChain)&&(this.$emit("suiMaster",e),e.getClient().then(t=>{this.$emit("client",t),this.$emit("provider",t),e.signer&&e.signer.activeAdapter&&(this.$emit("adapter",e.signer.activeAdapter),this.activeAdapter=e.signer.activeAdapter)}),this.getNameServiceName()),this.__suiMasterPromise&&this.suiMaster&&(this.__suiMasterPromiseResolver(),this.__suiMasterPromise=null),this.__connectedSuiMasterPromise&&this.isSuiMasterConnected()&&(this.__connectedSuiMasterPromiseResolver(),this.__connectedSuiMasterPromise=null)},onSuiAdapters(e){this.adapters=e},isSuiMasterConnected(e=null){return this.suiMaster&&this.suiMaster.address?!(e&&this.suiMaster.connectedChain!=e):this.suiMaster&&this.suiMaster.signer&&this.suiMaster.signer.connectedAddress?!(e&&this.suiMaster.signer.connectedChain!=e):!1},async onAdapterClick(e){if(this.showingDialog=!1,e.isDefault&&!e.isInstalled)return window.open(e.getDownloadURL(),"_blank"),!1;this.isLoading=!0,await this.$refs.sui.suiInBrowser.connect(e),this.persist&&window.localStorage.setItem("vue-sui-preferred-adapter",e.name),this.isLoading=!1},async setRPC(e={}){this.$refs.sui.setRPC(e)},async requestSuiMaster(){if(this.suiMaster)return this.suiMaster;if(await this.requestLibs(),await new Promise(e=>{setTimeout(e,200)}),this.suiMaster)return this.suiMaster;if(this.__suiMasterPromise){if(await this.__suiMasterPromise,this.suiMaster)return this.suiMaster;throw new Error("can not get suiMaster")}if(this.__suiMasterPromiseResolver=null,this.__suiMasterPromise=new Promise(e=>{this.__suiMasterPromiseResolver=e}),await this.__suiMasterPromise,this.suiMaster)return this.suiMaster;throw new Error("can not get suiMaster")},async requestConnectedSuiMaster(e=null){if(this.isSuiMasterConnected(e))return this.suiMaster;if(await this.requestLibs(),await new Promise(t=>{setTimeout(t,200)}),this.isSuiMasterConnected(e))return this.suiMaster;if(this.isLoading=!0,this.__connectedSuiMasterPromise){if(await this.__connectedSuiMasterPromise,this.isLoading=!1,this.isSuiMasterConnected(e))return this.suiMaster;throw new Error("can not get connection")}if(this.__connectedSuiMasterPromiseResolver=null,this.__connectedSuiMasterPromise=new Promise(t=>{this.__connectedSuiMasterPromiseResolver=t}),this.showingDialog=!0,await this.__connectedSuiMasterPromise,this.isLoading=!1,this.isSuiMasterConnected(e))return this.suiMaster;throw new Error("can not get connection")},async connect(){return await this.onClick()},async onClick(){this.isLoading=!0,await this.requestLibs(),await new Promise(e=>{setTimeout(e,200)}),this.connectedAddress||(this.showingDialog=!0),this.isLoading=!1},async initialize(){if(this.auto&&(this.isLoading=!0,await this.requestLibs(),this.isLoading=!1),await new Promise(e=>{setTimeout(e,200)}),this.persist){const e=window.localStorage.getItem("vue-sui-preferred-adapter");e&&this.adapters.forEach(t=>{t.name&&t.okForSui&&t.name==e&&this.onAdapterClick(t)})}},async requestLibs(){this.libsRequested=!0,await this.__libsRequestedPromise},onLibsLoaded(){this.__libsRequestedPromiseResolver()},onConnected(){this.showingDialog=!1;const e=this.$refs.sui.suiInBrowser.connectedChain;!this.defaultChain||this.defaultChain==e?(this.connectedAddress=this.$refs.sui.suiInBrowser.connectedAddress,this.connectedChain=this.$refs.sui.suiInBrowser.connectedChain,this.$emit("connected",this.connectedAddress),this.checkDisplayAddress()):(this.connectedAddress=null,this.$emit("wrongchain",e),this.checkDisplayAddress())},onDisconnected(){this.connectedAddress=null,this.$emit("disconnected"),this.checkDisplayAddress()},async disconnect(){window.localStorage.setItem("vue-sui-preferred-adapter",null);try{await this.activeAdapter.disconnect()}catch(e){return console.error(e),window.location.reload(),!1}return!0},setCache(e,t,s){const o={value:t,expiry:new Date().getTime()+s};window.localStorage.setItem(e,JSON.stringify(o))},getCache(e){try{const t=window.localStorage.getItem(e);if(!t)return;const s=JSON.parse(t);if(new Date().getTime()>s.expiry){window.localStorage.removeItem(e);return}return s.value}catch{return}}},beforeMount:function(){this.__libsRequestedPromiseResolver=null,this.__libsRequestedPromise=new Promise(e=>{this.__libsRequestedPromiseResolver=e})},mounted:async function(){this.initialize()}},B={key:0},I={key:1};function P(e,t,s,a,o,n){const r=i.resolveComponent("SignInWithSuiDialog"),l=i.resolveComponent("SuidoubleSync");return i.openBlock(),i.createElementBlock("div",null,[s.visible?(i.openBlock(),i.createElementBlock("div",{key:0,onClick:t[0]||(t[0]=(...u)=>n.onClick&&n.onClick(...u))},[o.connectedAddress?i.createCommentVNode("",!0):(i.openBlock(),i.createElementBlock("span",B,"Connect with Sui")),o.connectedAddress?(i.openBlock(),i.createElementBlock("span",I,i.toDisplayString(o.displayAddress),1)):i.createCommentVNode("",!0)])):i.createCommentVNode("",!0),i.createVNode(r,{showing:o.showingDialog,onHidden:t[1]||(t[1]=u=>{this.showingDialog=!1}),adapters:o.adapters,onClick:n.onAdapterClick},null,8,["showing","adapters","onClick"]),o.libsRequested?(i.openBlock(),i.createBlock(l,{key:1,ref:"sui",rpcSettings:s.rpcSettings,defaultChain:s.defaultChain,onAdapters:n.onSuiAdapters,onSuiMaster:n.onSuiMaster,onLoaded:n.onLibsLoaded,onConnected:n.onConnected,onDisconnected:n.onDisconnected},null,8,["rpcSettings","defaultChain","onAdapters","onSuiMaster","onLoaded","onConnected","onDisconnected"])):i.createCommentVNode("",!0)])}const f=h(A,[["render",P]]),D={name:"SignInWithSuiButton",emits:["suiMaster","provider","client","adapter","disconnected","connected","wrongchain","displayAddress"],props:{defaultChain:{default:"sui:devnet",type:String},persist:{default:!1,type:Boolean}},components:{SignInWithSui:f},data(){return{connectedAddress:null,connectedChain:null,displayAddress:null}},methods:{onClick(){this.connectedAddress?this.$refs.signin.disconnect():this.$refs.signin.connect()},onDisplayAddress(e){this.displayAddress=e,this.$emit("displayAddress",e)},onConnected(e){this.connectedAddress=e,this.$emit("connected",e)},onDisconnected(){this.connectedAddress=null,this.$emit("disconnected")},onWrongChain(e){this.$emit("wrongchain",e)},onSuiMaster(e){this.$emit("suiMaster",e)},onProvider(e){this.$emit("client",e),this.$emit("provider",e)},onAdapter(e){this.$emit("adapter",e)}}},N={class:"signinwithsui_button_inner"},E={key:0,class:"signinwithsui_button_inner"};function $(e,t,s,a,o,n){const r=i.resolveComponent("SignInWithSui");return i.openBlock(),i.createElementBlock("div",{class:"signinwithsui_button",onClick:t[0]||(t[0]=(...l)=>n.onClick&&n.onClick(...l))},[i.createElementVNode("div",N,[i.createVNode(r,{defaultChain:s.defaultChain,persist:s.persist,ref:"signin",onProvider:n.onProvider,onOnAdapter:n.onAdapter,onWrongchain:n.onWrongChain,onConnected:n.onConnected,onDisconnected:n.onDisconnected,onSuiMaster:n.onSuiMaster,onDisplayAddress:n.onDisplayAddress},null,8,["defaultChain","persist","onProvider","onOnAdapter","onWrongchain","onConnected","onDisconnected","onSuiMaster","onDisplayAddress"])]),o.connectedAddress?(i.openBlock(),i.createElementBlock("div",E,"disconnect")):i.createCommentVNode("",!0)])}const L=h(D,[["render",$],["__scopeId","data-v-9be482c4"]]);d.SignInWithSui=f,d.SignInWithSuiButton=L,Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})});
